---
title: "SB's commute"
output: word_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)

basedata <- read_excel('Commute.xlsx') %>% 
  data.frame() %>%
  mutate(traveltime = as.numeric(Arrive.time - Depart.time),
         delaytime = readr::parse_number(Notes),
         actualtravel = case_when(is.na(delaytime) ~ traveltime,
                                  T~ traveltime + delaytime),
         dayofweek = wday(Date, label = T)) %>% 
  filter(!is.na(actualtravel))  %>% 
  mutate(monthabb = format(Date, "%Y-%m")) %>% 
  filter(actualtravel <180)
```

## Introduction

Here is a rather rough-and-ready analysis of Sophie's commuting data from REDACTED to REDACTED.

The data covers the period from 31 August 2023 to 27 June 2024. After filtering out NAs, and one outlier (when REDACTED was closed, big ooft), the sample comprised 141 observations - 81 trips to work and 60 coming home. Travel times were adjusted based on stops for petrol, coffee, etc.

## Descriptive statistics
```{r cars, echo = F}

summary(basedata$actualtravel)
```

Across this time series, the median travel time was 79 minutes and the mean was 81.5 minutes (IQR 1-3: 71-88). The similarities in these measures of central tendency suggest a normal distribution (or 'bell-shaped curve') of the data. Your slowest trip was 125 minutes, whilst your quickest was over twice as fast at just 58 mins. 

## Disaggregation

Figure 1 shows that the mean travel time was slightly higher during trips home, but the two are not substantially different.

```{r fig1, echo =F, warning=F, fig.dim = c(8, 5)}
basedata %>% 
  ggplot(aes(x=actualtravel)) +
  geom_histogram(bins = 35) +
  facet_wrap(~Arrive.location) +
  labs(x = "travel time (mins)",
       y="",
       title = "Figure 1: Distribution of travel times buy destination") +
  theme_bw() +
  scale_x_continuous(limits = c(0,200), breaks = seq(0,200, 20)) +
  geom_vline(data = . %>% group_by(Arrive.location) %>% summarise(actualtravel = mean(actualtravel)), aes(xintercept = actualtravel))
```

Figure 2 shows that mean travel times were lowest on Monday and increased as the week wore on. The average trip home on a Thursday in particular was particularly brutal.

```{r fig2, echo = F, warning=F, fig.dim = c(8,5)}
basedata %>% 
  group_by(dayofweek, Arrive.location) %>% 
  summarise(test = mean(actualtravel)) %>% 
  ggplot(aes(x=dayofweek, y=test, group = Arrive.location, fill = Arrive.location))+
  geom_col(position = "dodge") +
  labs(y = "Average travel time",
       title = "Figure 2: Average travel times by day of the week",
       x = "Day of the week") +
  theme_bw()

```

Figure 3 shows mean travel times by month. The travel times were similar, with trips home being slightly longer on average. However, it appears that there was a downward trend on REDACTED-REDACTED journeys between February to June 2024. Not sure what factors were at play there but it appears you were doing something right.

```{r fig3, echo = F, warning=F,  fig.dim = c(8,5)}
basedata %>% 
  group_by(monthabb, Arrive.location) %>% 
  summarise(test = mean(actualtravel)) %>% 
  ggplot(aes(x = monthabb, y = test, group = Arrive.location, color = Arrive.location)) +
  geom_point()+
  geom_line()+
  scale_y_continuous(limits = c(0,100))+
  labs(x="",
       y="Average travel time (mins)",
       title = "Figure 3: Average travel time by month, August 2023 - June 2024") +
  theme_bw()
```

## Regression

I built a multiple linear regression model of your commute using time as the dependent variable and arrival location, day of the week and month as the predictor variables. All assumptions for linear regression were assessed and met.

This analysis suggested that, all else held constant, travelling on Tuesday took significantly longer than on Monday - about 6 minutes and 20 seconds on average. However there were no other significant results. Moreover the coefficient of determination was low (R^2 = 0.06) suggesting poor model fit, and the model itself was not significant (p > .05). In sum, these covariates explain minimal variation in the dependent variable, i.e. there are other factors at play the model hasn't accounted for (i.e. the distance) which are driving (pun somewhat intended) trends of your commute time

## Conclusion

Your commute consistently sucks. I am sorry.

If there is any other analysis you'd like me to run, for example adding 'cut points' in when you depart either location, or something else, let me know.
